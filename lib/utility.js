/*--------------------------------------------------------------------------------------------------------------------*/

let _cnt = 0;

const _paramRegExp = new RegExp('-\\W*([a-zA-Z][a-zA-Z0-9]*)\\W*=\\W*\\?', 'g');

/*--------------------------------------------------------------------------------------------------------------------*/

function buildCommandMessage(uuid, serverName, command, options)
{
	options = options || {};

	/*----------------------------------------------------------------------------------------------------------------*/

	const token = _cnt++;

	/*----------------------------------------------------------------------------------------------------------------*/

	const params = options.params || [];

	/*----------------------------------------------------------------------------------------------------------------*/

	const converter = ('converter' in options) ? (options.converter || '') : 'AMIXmlToJson.xsl';

	/*----------------------------------------------------------------------------------------------------------------*/

	command = (command || '').trim().replace(_paramRegExp, (x, y) => {

		return `-${y}="${String(params.shift()).replace('\\', '\\\\').replace('\n', '\\n').replace('"', '\\"').replace('\'', '\\\'')}"`;
	});

	/*----------------------------------------------------------------------------------------------------------------*/

	const topic = `ami/${serverName}/command/${converter}`;

	const message = `AMI-COMMAND<${token},"${uuid}","node-red">${command}`;

	/*----------------------------------------------------------------------------------------------------------------*/

	return {
		topic: topic,
		payload: message,
	};

	/*----------------------------------------------------------------------------------------------------------------*/
}

/*--------------------------------------------------------------------------------------------------------------------*/

module.exports = {
	buildCommandMessage: buildCommandMessage,
};

/*--------------------------------------------------------------------------------------------------------------------*/

